FROM mslipper/reference-optimistic-geth:latest

ARG L1_BLOCK_INFO_BYTECODE="608060405234801561001057600080fd5b50600436106100625760003560e01c806309bd5a60146100675780635cf24969146100855780638381f58a146100a3578063b80777ea146100c1578063c03ba43e146100df578063e591b282146100fb575b600080fd5b61006f610119565b60405161007c91906101fd565b60405180910390f35b61008d61011f565b60405161009a9190610231565b60405180910390f35b6100ab610125565b6040516100b89190610231565b60405180910390f35b6100c961012b565b6040516100d69190610231565b60405180910390f35b6100f960048036038101906100f491906102a9565b610131565b005b6101036101cc565b6040516101109190610351565b60405180910390f35b60035481565b60025481565b60005481565b60015481565b73deaddeaddeaddeaddeaddeaddeaddeaddead000173ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff16146101aa576040517fce8c104800000000000000000000000000000000000000000000000000000000815260040160405180910390fd5b8360008190555082600181905550816002819055508060038190555050505050565b73deaddeaddeaddeaddeaddeaddeaddeaddead000181565b6000819050919050565b6101f7816101e4565b82525050565b600060208201905061021260008301846101ee565b92915050565b6000819050919050565b61022b81610218565b82525050565b60006020820190506102466000830184610222565b92915050565b600080fd5b61025a81610218565b811461026557600080fd5b50565b60008135905061027781610251565b92915050565b610286816101e4565b811461029157600080fd5b50565b6000813590506102a38161027d565b92915050565b600080600080608085870312156102c3576102c261024c565b5b60006102d187828801610268565b94505060206102e287828801610268565b93505060406102f387828801610268565b925050606061030487828801610294565b91505092959194509250565b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b600061033b82610310565b9050919050565b61034b81610330565b82525050565b60006020820190506103666000830184610342565b9291505056fea2646970667358221220cdaea4f1ee477c3fe7f1b3caa2283ad58d53d6a652006ec9e6f6bf22354b258264736f6c634300080a0033"
ARG WITHDRAWOR_BYTECODE="6080604052600436106100345760003560e01c8063affed0e014610039578063c2b3e5ac14610064578063efbf64a714610080575b600080fd5b34801561004557600080fd5b5061004e6100bd565b60405161005b919061027c565b60405180910390f35b61007e60048036038101906100799190610390565b6100c3565b005b34801561008c57600080fd5b506100a760048036038101906100a2919061043a565b610243565b6040516100b49190610482565b60405180910390f35b60005481565b60006040518060a0016040528060005481526020013373ffffffffffffffffffffffffffffffffffffffff1681526020018673ffffffffffffffffffffffffffffffffffffffff16815260200134815260200184848080601f016020809104026020016040519081016040528093929190818152602001838380828437600081840152601f19601f82011690508083019250505050505050815250905060008160405160200161017391906105ca565b604051602081830303815290604052805190602001209050600180600083815260200190815260200160002060006101000a81548160ff0219169083151502179055506000808154809291906101c89061061b565b91905055508573ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff166000547f87bf7b546c8de873abb0db5b579ec131f8d0cf5b14f39933551cf9ced23a61363489898960405161023394939291906106b1565b60405180910390a4505050505050565b60016020528060005260406000206000915054906101000a900460ff1681565b6000819050919050565b61027681610263565b82525050565b6000602082019050610291600083018461026d565b92915050565b600080fd5b600080fd5b600073ffffffffffffffffffffffffffffffffffffffff82169050919050565b60006102cc826102a1565b9050919050565b6102dc816102c1565b81146102e757600080fd5b50565b6000813590506102f9816102d3565b92915050565b61030881610263565b811461031357600080fd5b50565b600081359050610325816102ff565b92915050565b600080fd5b600080fd5b600080fd5b60008083601f8401126103505761034f61032b565b5b8235905067ffffffffffffffff81111561036d5761036c610330565b5b60208301915083600182028301111561038957610388610335565b5b9250929050565b600080600080606085870312156103aa576103a9610297565b5b60006103b8878288016102ea565b94505060206103c987828801610316565b935050604085013567ffffffffffffffff8111156103ea576103e961029c565b5b6103f68782880161033a565b925092505092959194509250565b6000819050919050565b61041781610404565b811461042257600080fd5b50565b6000813590506104348161040e565b92915050565b6000602082840312156104505761044f610297565b5b600061045e84828501610425565b91505092915050565b60008115159050919050565b61047c81610467565b82525050565b60006020820190506104976000830184610473565b92915050565b6104a681610263565b82525050565b6104b5816102c1565b82525050565b600081519050919050565b600082825260208201905092915050565b60005b838110156104f55780820151818401526020810190506104da565b83811115610504576000848401525b50505050565b6000601f19601f8301169050919050565b6000610526826104bb565b61053081856104c6565b93506105408185602086016104d7565b6105498161050a565b840191505092915050565b600060a08301600083015161056c600086018261049d565b50602083015161057f60208601826104ac565b50604083015161059260408601826104ac565b5060608301516105a5606086018261049d565b50608083015184820360808601526105bd828261051b565b9150508091505092915050565b600060208201905081810360008301526105e48184610554565b905092915050565b7f4e487b7100000000000000000000000000000000000000000000000000000000600052601160045260246000fd5b600061062682610263565b91507fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffff821415610659576106586105ec565b5b600182019050919050565b600082825260208201905092915050565b82818337600083830152505050565b60006106908385610664565b935061069d838584610675565b6106a68361050a565b840190509392505050565b60006060820190506106c6600083018761026d565b6106d3602083018661026d565b81810360408301526106e6818486610684565b90509594505050505056fea2646970667358221220b1d1683e97ed6c5d706887aebe525fb771a3f3be79f42e53ae8d574e5037304264736f6c634300080a0033"

RUN apk add --no-cache jq

COPY entrypoint.sh /entrypoint.sh
COPY genesis-l2.json /genesis.json

RUN cat /genesis.json | jq ". | .alloc.\"4200000000000000000000000000000000000014\".code = \"$L1_BLOCK_INFO_BYTECODE\"" | tee /genesis-with-bytecode.json && \
    mv /genesis-with-bytecode.json /genesis.json

VOLUME ["/db"]

ENTRYPOINT ["/bin/sh", "/entrypoint.sh"]
